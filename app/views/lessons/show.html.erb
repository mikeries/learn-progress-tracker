<div id='lesson-content'>
  <%= render partial: 'lesson_header', locals: {lesson: @lesson} %>
  <div class='tags panel panel-default'>
    <div class="panel-heading">
      <span>Tags</span>
      <%= nav_button_for('Tags') %>
    </div>
    <div class='tag-list panel-body'>
      <%= "You have no tags for this lesson." if @lesson.tags.empty? %>
      <%= render @lesson.tags.order(:category).distinct unless @lesson.tags.empty?%>
    </div>
  </div>

  <div class='notes panel panel-default'>
    <div class='panel-heading'>
      <span>Notes</span>
      <%= nav_button_for('Notes') %>
    </div>
    <div class='panel-body'>
      <%= "You have no notes for this lesson." if @note.nil? %>
      <%= @note.content unless @note.nil? %>
    </div>
  </div>
</div>

<script id="lesson-template" type="text/x-handlebars-template">
  <div class="btn-toolbar">
    <div class="btn-group" role="group">
      <a href="/lessons"><button type="button" class="btn btn-default">Index</button></a>
      <a href={{previous_lesson_link}}><button type="button" class="btn btn-default page-button">Previous</button></a>
      <a href="{{next_lesson_link}}"><button type="button" class="btn btn-default page-button">Next</button></a>
    </div>
  </div>

  <h3>
    <i class="fa {{statusIconName}}"></i>
    <i class="fa {{typeIconName}}"></i>
    <a target="_blank" href="{{url}}">{{title}}</a>
  </h3>
  {{> tagsPartial }}
  {{> notesPartial }}
</script>

<script id="lesson-tags-partial" type="text/x-handlebars-template">
  <div class="tags panel panel-default">
    <div class="panel-heading">
      <span>Tags</span>
      <a href="/lessons/{{id}}/edit"><button type="button" class="btn btn-default tags-button">Tags</button></a>
    </div>
    <div class="tag-list panel-body">
      {{#if sortedTags }}
        {{#each sortedTags}}
          <div>{{category}}</div>
        {{/each}}
      {{ else }}
        <p>You have no tags for this lesson.</p>
      {{/if}}
    </div>
  </div>
</script>

<script id='lesson-notes-partial' type='text/x-handlebars-template'>
  <div class="notes panel panel-default">
    <div class="panel-heading">
      <span>Notes</span>
      <a href="/lessons/{{id}}/notes/new"><button type="button" class="btn btn-default">Notes</button></a>
    </div>
    <div class="panel-body">
      {{#if notes}}
        {{#each notes}}
        <p>{{content}}</p>
        {{/each}}
      {{ else }}
        <p>You have no notes for this lesson.</p>
      {{/if}}
    </div>
  </div>
</script>

<script id='lesson-edit-template' type='text/x-handlebars-template'>
  <div class='btn-toolbar'>
    <div class="btn-group" role="group">
      <a href="/lessons"><button type='button' class='btn btn-default '>Index</button></a>
      <a href="/lessons/188"><button type='button' class='btn btn-default page-button'>Previous</button></a>
      <a href="/lessons/190"><button type='button' class='btn btn-default page-button'>Next</button></a>
    </div>
  </div>

  <h3>
    <i class="fa {{statusIconName}}"></i>
    <i class="fa {{typeIconName}}"></i>
    <a target="_blank" href="{{url}}">{{title}}</a>
  </h3>
  {{>lessonEditPartial}}
</script>

<script id="lesson-edit-partial" type="text/x-handlebars-template">
  <div class='tags panel panel-default'>
    <div class='panel-heading'>Available Tags</div>
    <div class='panel-body'>
      <form class="edit_lesson" id="edit_lesson_{{id}}" action="/lessons/{{id}}" accept-charset="UTF-8" method="post">
        <input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="_method" value="patch" />
        <%= hidden_field_tag :authenticity_token, form_authenticity_token %>

        <div class='tag-list'>
          <input type="hidden" name="lesson[tag_ids][]" value="" />
          {{#each sortedTags}}
            <span class='tag-label'>
              {{category}}
            </span>
            <span class='check_box'>
              <input type="checkbox" value="{{value}}" {{ checked? }} name="lesson[tag_ids][]" id="lesson_tag_ids_{{id}}" />
            </span>
            <br />
          {{/each}}
        </div>

        <hr />
        <label for="lesson_tags_attributes_0_category">New Tag:</label>
        <input type="text" name="lesson[tags_attributes][0][category]" id="lesson_tags_attributes_0_category" />
        <hr />

        <button name="button" type="submit" class="btn btn-default">Update Tags</button>
        <a href="/lessons/{{id}}"><button type='button' class='btn btn-default '>Back</button></a>
      </form>
    </div>
  </div>
</script>